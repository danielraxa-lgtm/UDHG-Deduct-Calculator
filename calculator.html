<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UDHG Insurance Hub</title>
    <style>
        :root {
            --primary-color: #8B0000; /* Dark Red/Burgundy */
            --bg-color: #f4f4f4;
            --text-color: #333;
            --border-radius: 6px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        /* HEADER */
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
        }
        .header h1 { margin: 0; font-size: 1.5rem; }
        .header p { margin: 5px 0 0; font-size: 0.9rem; opacity: 0.9; }

        /* TABS (Visual Only) */
        .nav-tabs {
            background-color: white;
            padding: 0 2rem;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 1rem;
        }
        .nav-item {
            padding: 1rem;
            cursor: pointer;
            color: #666;
            font-weight: 500;
        }
        .nav-item.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
        }

        /* MAIN CONTAINER */
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: grid;
            grid-template-columns: 1fr 1fr; /* Two Columns */
            gap: 2rem;
        }

        /* INPUTS (Left Column) */
        .input-group { margin-bottom: 1.5rem; }
        label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: #444; }
        select, input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            box-sizing: border-box;
        }
        select:focus, input:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        .hidden { display: none; }

        /* RESULTS (Right Column) */
        .results-panel {
            background-color: #f9f9f9;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 1px solid #eee;
        }
        .results-header {
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #ddd;
            padding-bottom: 0.5rem;
        }
        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }
        .total-row {
            border-top: 2px solid #ddd;
            padding-top: 1rem;
            margin-top: 1rem;
            font-weight: bold;
            font-size: 1.2rem;
            color: #333;
        }

        /* INFO BOX */
        .info-box {
            grid-column: 1 / -1; /* Spans both columns */
            background-color: #eef6fc;
            border-left: 4px solid #2c88d9;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #2c3e50;
        }

        /* FOOTER */
        .footer {
            text-align: center;
            font-size: 0.8rem;
            color: #888;
            margin: 2rem 0;
            padding: 0 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>UNIFIED DOOR & HARDWARE — Insurance Hub</h1>
        <p>OCIP/CCIP Process, Deduction Calculator, COI Requests & More</p>
    </div>

    <div class="nav-tabs">
        <div class="nav-item">Process Flow</div>
        <div class="nav-item active">Deduction Calculator</div>
        <div class="nav-item">COI Requests</div>
        <div class="nav-item">FAQ</div>
    </div>

    <div class="container">
        
        <div class="input-section">
            <h3 style="color:var(--primary-color); margin-top:0;">Project Inputs</h3>

            <div class="input-group">
                <label for="stateSelector">Project State</label>
                <select id="stateSelector" onchange="calculate()">
                    <option value="">-- Select State --</option>
                    <option value="AZ">Arizona (AZ)</option>
                    <option value="CO">Colorado (CO)</option>
                    <option value="FL">Florida (FL)</option>
                    <option value="MD">Maryland (MD)</option>
                    <option value="MI">Michigan (MI)</option>
                    <option value="NJ">New Jersey (NJ)</option>
                    <option value="NY">New York (NY)</option>
                    <option value="PA">Pennsylvania (PA)</option>
                    <option value="TX">Texas (TX)</option>
                    <option value="OTHER">Other State (Default)</option>
                </select>
            </div>

            <div class="input-group">
                <label for="contractValue">Contract or Change Order Value ($)</label>
                <input type="number" id="contractValue" placeholder="e.g. 500000" oninput="calculate()">
                <small style="color:#666; display:block; margin-top:4px;">Basis for GL & Umbrella calculations</small>
            </div>

            <div class="input-group">
                <label for="laborScope">Labor Scope</label>
                <select id="laborScope" onchange="togglePayroll()">
                    <option value="none">None (Delivery/Supply Only)</option>
                    <option value="sub">Subcontracted</option>
                    <option value="self">Self-Install (UDHG Crews)</option>
                </select>
            </div>

            <div class="input-group hidden" id="payrollGroup">
                <label for="payrollInput">Estimated Labor Payroll ($)</label>
                <input type="number" id="payrollInput" placeholder="Enter labor cost (not sell price)" oninput="calculate()">
                <small style="color:#666; display:block; margin-top:4px;">Basis for Workers' Comp calculation</small>
            </div>
        </div>

        <div class="results-panel">
            <div class="results-header">Insurance Deduction Results</div>

            <div class="result-row">
                <span>Workers' Comp (WC) <small id="wc-rate-display" style="color:#888;">(Rate: --)</small></span>
                <span id="wcResult">$0.00</span>
            </div>

            <div class="result-row">
                <span>General Liability (GL) <small style="color:#888;">(0.1506 / $1k)</small></span>
                <span id="glResult">$0.00</span>
            </div>

            <div class="result-row">
                <span>Umbrella <small style="color:#888;">(0.36691 / $1k)</small></span>
                <span id="umbrellaResult">$0.00</span>
            </div>

            <div class="result-row total-row">
                <span>Total OCIP/CCIP Deduction</span>
                <span id="totalResult" style="color:var(--primary-color);">$0.00</span>
            </div>
        </div>

        <div class="info-box">
            <strong>Why labor cost, not labor sell?</strong> Insurance is based on actual exposure (what we pay workers), not what we charge customers. Using sell price includes our markup and profit—giving that away as a deduction means we lose money.
        </div>
    </div>

    <div class="footer">
        UDHG Insurance Hub | Calculator rates effective 6/1/2025 – 6/1/2026<br>
        Questions? Contact Risk Management: riskmanagement@myfbm.com | 657-472-1661
    </div>

    <script>
        // 1. DATA: State Specific WC Rates
        const wcRates = {
            "AZ": { code: "5102", base: 3.31, emr: 0.95, ldf: 0.2737 },
            "CO": { code: "5102", base: 3.29, emr: 0.95, ldf: 0.0549 },
            "FL": { code: "5102", base: 5.33, emr: 0.95, ldf: 0.2124 },
            "MI": { code: "5146", base: 7.54, emr: 0.65, ldf: 0.1100 },
            "MD": { code: "5102", base: 4.09, emr: 0.95, ldf: 0.0548 },
            "NJ": { code: "5103", base: 6.28, emr: 1.115, ldf: 0.0829 },
            "NY": { code: "5102", base: 11.17, emr: 1.87, ldf: 0.0832 },
            "PA": { code: "658", base: 6.43, emr: 1.143, ldf: 0.1931 },
            "TX": { code: "5102", base: 2.15, emr: 0.95, ldf: 0.0800 }
        };

        const DEFAULT_WC_RATE = 0.1665; // Flat rate for other states
        const GL_RATE = 0.1506;         // Per $1,000 Contract Value
        const UMBRELLA_RATE = 0.36691;  // Per $1,000 Contract Value

        // 2. TOGGLE PAYROLL INPUT
        function togglePayroll() {
            const scope = document.getElementById("laborScope").value;
            const payrollGroup = document.getElementById("payrollGroup");
            
            if (scope === "none") {
                payrollGroup.classList.add("hidden");
                document.getElementById("payrollInput").value = ""; // Clear value
            } else {
                payrollGroup.classList.remove("hidden");
            }
            calculate(); // Recalculate immediately
        }

        // 3. MAIN CALCULATION FUNCTION
        function calculate() {
            // Get Inputs
            const state = document.getElementById("stateSelector").value;
            const contractVal = parseFloat(document.getElementById("contractValue").value) || 0;
            const payrollVal = parseFloat(document.getElementById("payrollInput").value) || 0;
            const scope = document.getElementById("laborScope").value;

            // --- A. CALCULATE GL & UMBRELLA (Based on Contract Value) ---
            // Formula: (Value / 1000) * Rate
            let glPremium = (contractVal / 1000) * GL_RATE;
            let umbrellaPremium = (contractVal / 1000) * UMBRELLA_RATE;

            // --- B. CALCULATE WORKERS COMP (Based on Payroll) ---
            let wcPremium = 0;
            let finalWcRate = 0;

            if (scope !== "none" && state) {
                // Determine Rate
                if (wcRates[state]) {
                    // Use specific formula: Base * EMR * (1 - LDF)
                    const data = wcRates[state];
                    finalWcRate = data.base * data.emr * (1 - data.ldf);
                } else {
                    // Use Default
                    finalWcRate = DEFAULT_WC_RATE;
                }

                // Calculate Premium: (Payroll / 100) * Rate
                wcPremium = (payrollVal / 100) * finalWcRate;
            }

            // --- C. DISPLAY RESULTS ---
            
            // Format Numbers to Currency
            const fmt = (num) => "$" + num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

            document.getElementById("glResult").innerText = fmt(glPremium);
            document.getElementById("umbrellaResult").innerText = fmt(umbrellaPremium);
            document.getElementById("wcResult").innerText = fmt(wcPremium);
            
            // Show active WC rate for clarity
            if (scope !== "none" && state) {
                document.getElementById("wc-rate-display").innerText = `(Rate: $${finalWcRate.toFixed(4)})`;
            } else {
                document.getElementById("wc-rate-display").innerText = "(Rate: --)";
            }

            // Grand Total
            const total = glPremium + umbrellaPremium + wcPremium;
            document.getElementById("totalResult").innerText = fmt(total);
        }
    </script>
</body>
</html>
