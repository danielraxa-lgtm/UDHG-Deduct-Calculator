<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Cost Worksheet Calculator</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px 40px;
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .header .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .confidential-banner {
            background: #c0392b;
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .confidential-banner strong {
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #2c3e50;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 0 6px 6px 0;
        }
        
        .calc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 768px) {
            .calc-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .calc-section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .calc-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.1rem;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #444;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2c3e50;
        }
        
        .form-group small {
            display: block;
            margin-top: 4px;
            color: #888;
            font-size: 0.85rem;
        }
        
        .results {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .result-row:last-child {
            border-bottom: none;
        }
        
        .result-row.total {
            font-weight: 700;
            font-size: 1.2rem;
            color: #2c3e50;
            border-top: 2px solid #2c3e50;
            margin-top: 10px;
            padding-top: 15px;
        }
        
        .result-label {
            color: #666;
        }
        
        .result-value {
            font-weight: 600;
        }
        
        .subcontractor-section {
            display: none;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .subcontractor-section.show {
            display: block;
        }
        
        .subcontractor-section h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        .alert {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
            display: none;
        }
        
        .alert.show {
            display: block;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            text-decoration: none;
            transition: background 0.2s;
        }
        
        .btn:hover {
            background: #1a252f;
        }
        
        .btn-warning {
            background: #f39c12;
        }
        
        .btn-warning:hover {
            background: #d68910;
        }
        
        .btn-back {
            background: #7f8c8d;
            margin-bottom: 20px;
        }
        
        .btn-back:hover {
            background: #636e72;
        }
        
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: #888;
            font-size: 0.85rem;
            border-top: 1px solid #ddd;
            margin-top: 40px;
        }
        
        .footer .developer {
            margin-bottom: 10px;
            color: #666;
        }
        
        .contact-box {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }
        
        .contact-box p {
            margin: 5px 0;
            color: #555;
        }
        
        .warning-text {
            color: #856404;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .result-row.subtotal {
            border-top: 1px solid #ccc;
            margin-top: 5px;
            padding-top: 12px;
        }

        .result-row.op-row {
            color: #27ae60;
        }

        .result-row.op-row .result-value {
            color: #27ae60;
        }

        .op-checkbox {
            margin-top: 15px;
            padding: 12px;
            background: #f0f9f4;
            border-radius: 6px;
            border: 1px solid #27ae60;
        }

        .op-checkbox label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-weight: 500;
            color: #27ae60;
        }

        .op-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .rate-info {
            background: #e8f4f8;
            border-radius: 6px;
            padding: 12px;
            margin-top: 15px;
            font-size: 0.85rem;
        }

        .rate-info h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .rate-info p {
            margin: 4px 0;
            color: #555;
        }

        .rate-info .effective-rate {
            font-weight: 600;
            color: #27ae60;
        }
    </style>
</head>
<body>
    <div class="confidential-banner">
        <strong>‚ö†Ô∏è Confidential</strong> ‚Äî Internal use only. Do not distribute this calculator to external parties.
    </div>
    
    <div class="header">
        <h1>Insurance Cost Worksheet Calculator</h1>
        <div class="subtitle">OCIP/CCIP Deduction Estimator for Bid Preparation | Updated Feb 2026</div>
    </div>
    
    <div class="container">
        <a href="https://wrapenrollmentguidetest-1-draft.netlify.app/" class="btn btn-back">‚Üê Back to Insurance Hub</a>
        
        <div class="info-box">
            <strong>Purpose:</strong> This calculator is intended for estimating insurance deductions during the bid process, typically prior to any contracts being signed. Use it to calculate OCIP/CCIP credits for your bid pricing. <strong>Note:</strong> Large deductible factors are applied automatically for applicable states.
        </div>
        
        <div class="calc-grid">
            <div class="calc-section">
                <h2>Project Information</h2>
                
                <div class="form-group">
                    <label for="projectName">Project Name</label>
                    <input type="text" id="projectName" placeholder="e.g., Downtown Office Tower Phase 2">
                </div>
                
                <div class="form-group">
                    <label for="state">Project State</label>
                    <select id="state" onchange="calculate()">
                        <option value="">Select State...</option>
                        <option value="AZ">Arizona (AZ)</option>
                        <option value="CO">Colorado (CO)</option>
                        <option value="CT">Connecticut (CT)</option>
                        <option value="FL">Florida (FL)</option>
                        <option value="MA">Massachusetts (MA)</option>
                        <option value="MD">Maryland (MD)</option>
                        <option value="MI">Michigan (MI)</option>
                        <option value="NJ">New Jersey (NJ)</option>
                        <option value="NY">New York (NY)</option>
                        <option value="PA">Pennsylvania (PA)</option>
                        <option value="RI">Rhode Island (RI)</option>
                        <option value="TX">Texas (TX)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="contractValue">Contract or Change Order Value ($)</label>
                    <input type="text" id="contractValue" placeholder="e.g., 500,000" oninput="formatNumberInput(this); calculate()">
                    <small>Total sell price for the scope</small>
                </div>
                
                <div class="form-group">
                    <label for="laborScope">Labor Scope</label>
                    <select id="laborScope" onchange="toggleLaborFields(); calculate()">
                        <option value="none">None (Delivery/Supply Only)</option>
                        <option value="subcontracted">Subcontracted</option>
                        <option value="self">Self-Performed Crews</option>
                    </select>
                </div>
                
                <div class="form-group" id="payrollGroup" style="display: none;">
                    <label for="payroll">Estimated Self-Performed Payroll ($)</label>
                    <input type="text" id="payroll" placeholder="e.g., 100,000" oninput="formatNumberInput(this); calculate()">
                    <small>Use labor COST (payroll), not labor sell!</small>
                </div>
                
                <!-- Rate Info Box -->
                <div class="rate-info" id="rateInfoBox" style="display: none;">
                    <h4>üìä Rate Breakdown for <span id="rateState"></span></h4>
                    <p>Base WC Rate (5102): <span id="displayBaseRate"></span> per $100</p>
                    <p>EMR: <span id="displayEMR"></span></p>
                    <p>Large Deductible Factor: <span id="displayLDF"></span></p>
                    <p class="effective-rate">Effective WC Rate: <span id="displayEffectiveRate"></span> per $100</p>
                </div>
                
                <!-- Subcontractor Section -->
                <div class="subcontractor-section" id="subcontractorSection">
                    <h3>üìã Subcontractor Information Required</h3>
                    <p class="warning-text">When labor is subcontracted, we need the following information to coordinate wrap enrollment:</p>
                    
                    <div class="form-group">
                        <label for="subAmount">Subcontracted Labor Amount ($)</label>
                        <input type="text" id="subAmount" placeholder="e.g., 75,000" oninput="formatNumberInput(this)">
                    </div>
                    
                    <div class="form-group">
                        <label for="subName">Subcontractor Company Name</label>
                        <input type="text" id="subName" placeholder="e.g., ABC Installation Services">
                    </div>
                    
                    <div class="form-group">
                        <label for="subContactName">Subcontractor Contact Name</label>
                        <input type="text" id="subContactName" placeholder="e.g., John Smith">
                    </div>
                    
                    <div class="form-group">
                        <label for="subContactEmail">Subcontractor Contact Email</label>
                        <input type="email" id="subContactEmail" placeholder="e.g., jsmith@abcinstall.com">
                    </div>
                    
                    <button class="btn btn-warning" onclick="draftSubcontractorEmail()">üìß Draft Email to Wrap Enrollment</button>
                </div>
            </div>
            
            <div class="calc-section">
                <h2>Insurance Deduction Results</h2>
                
                <div class="results">
                    <div class="result-row">
                        <span class="result-label">Workers' Comp (WC)</span>
                        <span class="result-value" id="wcResult">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">General Liability (GL)</span>
                        <span class="result-value" id="glResult">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Umbrella/Excess</span>
                        <span class="result-value" id="umbrellaResult">$0</span>
                    </div>
                    <div class="result-row subtotal">
                        <span class="result-label">Subtotal</span>
                        <span class="result-value" id="subtotalResult">$0</span>
                    </div>
                    <div class="result-row op-row" id="opRow" style="display: none;">
                        <span class="result-label">Overhead & Profit (15%)</span>
                        <span class="result-value" id="opResult">$0</span>
                    </div>
                    <div class="result-row total">
                        <span class="result-label">Total OCIP/CCIP Deduction</span>
                        <span class="result-value" id="totalResult">$0</span>
                    </div>
                </div>

                <div class="op-checkbox">
                    <label>
                        <input type="checkbox" id="includeOP" onchange="calculate()">
                        Include 15% Overhead & Profit
                    </label>
                </div>
                
                <div class="alert" id="subAlert">
                    <strong>Note:</strong> Labor is subcontracted. WC exposure belongs to the subcontractor. Please complete the subcontractor information and notify the Wrap Enrollment team.
                </div>
                
                <div class="contact-box">
                    <p><strong>Questions?</strong></p>
                    <p>Contact the Wrap Enrollment Team</p>
                    <p><a href="mailto:wrap.enrollment@myfbm.com">wrap.enrollment@myfbm.com</a></p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <div class="developer">Developed by Daniel Raxa</div>
        <p>For internal bid preparation use only. Contact wrap.enrollment@myfbm.com for enrollment questions.</p>
        <p style="margin-top: 10px; font-size: 0.8rem;">Last Updated: February 2026 | Policy Year 2025-26</p>
    </div>
    
    <script>
        // =========================================
        // WC BASE RATES BY STATE (Class Code 5102 - Installation)
        // Source: 25-26 WC Policy Endorsements
        // =========================================
        const wcRates = {
            'AZ': 3.31,
            'CO': 3.29,
            'CT': 4.61,   // From endorsement - Door/Window Installation
            'FL': 5.33,
            'MA': 4.56,   // From endorsement - Door/Sash Erection Metal
            'MD': 4.09,
            'MI': 7.54,
            'NJ': 6.28,
            'NY': 11.17,
            'PA': 6.43,
            'RI': 3.54,   // From endorsement - Door/Window Installation
            'TX': 2.15
        };

        // =========================================
        // LARGE DEDUCTIBLE FACTORS BY STATE
        // Source: 25-26 WC Policy Rating Pages
        // $500K Deductible Program
        // =========================================
        const ldFactors = {
            'AZ': 1.0,    // No LD factor on file
            'CO': 1.0,    // No LD factor on file
            'CT': 0.0832, // From CT rating page (code 9663)
            'FL': 1.0,    // No LD factor on file
            'MA': 1.0,    // MA has no large deductible - different program structure
            'MD': 1.0,    // No LD factor on file
            'MI': 1.0,    // No LD factor on file
            'NJ': 1.0,    // No LD factor on file
            'NY': 1.0,    // No LD factor on file
            'PA': 1.0,    // No LD factor on file
            'RI': 0.0548, // From RI rating page (code 9664)
            'TX': 1.0     // No LD factor on file
        };

        // =========================================
        // EMR (EXPERIENCE MODIFICATION RATE) BY STATE
        // Source: 25-26 WC Policy Rating Pages
        // =========================================
        const emrFactors = {
            'AZ': 1.0,
            'CO': 1.0,
            'CT': 1.01,   // From CT rating page
            'FL': 1.0,
            'MA': 1.01,   // From MA rating page
            'MD': 1.0,
            'MI': 1.0,
            'NJ': 1.0,
            'NY': 1.0,
            'PA': 1.0,
            'RI': 1.01,   // From RI rating page
            'TX': 1.0
        };

        // GL and Umbrella rates (per $1,000 of contract value)
        const glRate = 0.1506;
        const umbrellaRate = 0.36691;

        // Format number input with commas as user types
        function formatNumberInput(input) {
            const cursorPos = input.selectionStart;
            const oldLength = input.value.length;

            let value = input.value.replace(/[^0-9.]/g, '');

            const parts = value.split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');

            input.value = parts.join('.');

            const newLength = input.value.length;
            const diff = newLength - oldLength;
            input.setSelectionRange(cursorPos + diff, cursorPos + diff);
        }

        // Parse comma-formatted number back to float
        function parseNumber(value) {
            if (!value) return 0;
            return parseFloat(value.replace(/,/g, '')) || 0;
        }
        
        function toggleLaborFields() {
            const laborScope = document.getElementById('laborScope').value;
            const payrollGroup = document.getElementById('payrollGroup');
            const subcontractorSection = document.getElementById('subcontractorSection');
            const subAlert = document.getElementById('subAlert');
            
            payrollGroup.style.display = 'none';
            subcontractorSection.classList.remove('show');
            subAlert.classList.remove('show');
            
            if (laborScope === 'self') {
                payrollGroup.style.display = 'block';
            } else if (laborScope === 'subcontracted') {
                subcontractorSection.classList.add('show');
                subAlert.classList.add('show');
            }
            
            if (laborScope !== 'self') {
                document.getElementById('payroll').value = '';
            }
        }
        
        function calculate() {
            const state = document.getElementById('state').value;
            const contractValue = parseNumber(document.getElementById('contractValue').value);
            const laborScope = document.getElementById('laborScope').value;
            const payroll = parseNumber(document.getElementById('payroll').value);
            const includeOP = document.getElementById('includeOP').checked;

            let wc = 0, gl = 0, umbrella = 0;

            // GL and Umbrella based on contract value
            gl = (contractValue / 1000) * glRate;
            umbrella = (contractValue / 1000) * umbrellaRate;

            // WC calculation with Large Deductible Factor and EMR
            const rateInfoBox = document.getElementById('rateInfoBox');
            
            if (laborScope === 'self' && state && wcRates[state]) {
                const baseRate = wcRates[state];
                const ldFactor = ldFactors[state] || 1.0;
                const emr = emrFactors[state] || 1.0;
                
                // Calculate effective rate
                const effectiveRate = baseRate * emr * ldFactor;
                
                // Calculate WC deduction
                wc = (payroll / 100) * effectiveRate;
                
                // Display rate breakdown
                rateInfoBox.style.display = 'block';
                document.getElementById('rateState').textContent = state;
                document.getElementById('displayBaseRate').textContent = baseRate.toFixed(3);
                document.getElementById('displayEMR').textContent = emr.toFixed(2);
                document.getElementById('displayLDF').textContent = ldFactor < 1 ? ldFactor.toFixed(4) + ' (' + ((1 - ldFactor) * 100).toFixed(2) + '% credit)' : 'N/A (1.0)';
                document.getElementById('displayEffectiveRate').textContent = effectiveRate.toFixed(4);
            } else {
                rateInfoBox.style.display = 'none';
            }

            // Round to whole dollars
            wc = Math.round(wc);
            gl = Math.round(gl);
            umbrella = Math.round(umbrella);
            const subtotal = wc + gl + umbrella;

            // Optional O&P markup
            let op = 0;
            if (includeOP) {
                op = Math.round(subtotal * 0.15);
            }

            const total = subtotal + op;

            // Update display
            document.getElementById('wcResult').textContent = '$' + wc.toLocaleString();
            document.getElementById('glResult').textContent = '$' + gl.toLocaleString();
            document.getElementById('umbrellaResult').textContent = '$' + umbrella.toLocaleString();
            document.getElementById('subtotalResult').textContent = '$' + subtotal.toLocaleString();
            document.getElementById('opResult').textContent = '$' + op.toLocaleString();
            document.getElementById('opRow').style.display = includeOP ? 'flex' : 'none';
            document.getElementById('totalResult').textContent = '$' + total.toLocaleString();
        }
        
        function draftSubcontractorEmail() {
            const projectName = document.getElementById('projectName').value || '[Project Name]';
            const state = document.getElementById('state').value || '[State]';
            const contractValue = parseNumber(document.getElementById('contractValue').value);
            const subAmount = parseNumber(document.getElementById('subAmount').value);
            const subName = document.getElementById('subName').value || '[Subcontractor Name]';
            const subContactName = document.getElementById('subContactName').value || '[Contact Name]';
            const subContactEmail = document.getElementById('subContactEmail').value || '[Contact Email]';

            const subject = `Wrap Enrollment Notice - Subcontracted Labor - ${projectName}`;

            const body = `Hi Wrap Enrollment Team,

I'm submitting a bid that includes subcontracted labor and wanted to notify you for wrap enrollment coordination.

PROJECT DETAILS:
- Project Name: ${projectName}
- State: ${state}
- Contract Value: $${contractValue.toLocaleString()}

SUBCONTRACTOR INFORMATION:
- Subcontracted Labor Amount: $${subAmount.toLocaleString()}
- Subcontractor Company: ${subName}
- Contact Name: ${subContactName}
- Contact Email: ${subContactEmail}

Please let me know if you need any additional information for enrollment.

Thanks`;
            
            const mailtoLink = `mailto:wrap.enrollment@myfbm.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoLink;
        }
    </script>
</body>
</html>
